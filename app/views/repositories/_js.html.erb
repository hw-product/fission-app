<%= javascript_tag do %>
  jQuery(document).ready(function($){
    <% if(defined?(repositories)) -%>
      $('input#repository').autocomplete({
        minLength: 0,
        focus: function(event, ui){
          $('input#repository').val(ui.item.value);
          return false;
        },
        select: function(event, ui){
          repo_url = ui.item.url;
          return false;
        },
        source: [<%=
                   repositories.map{|repo|
                     val = []
                     val << "url: '#{repository_enable_url(Base64.encode64(repo[:full_name]))}'"
                     val << "value: '#{repo[:full_name]}'"
                     "{#{val.join(', ')}}"
                   }.join(', ').html_safe
                 %>]
      });
    <% end -%>

    var repo_url = null;
    $(".linked").click(function(){
      window.document.location = $(this).attr("href");
    });
    $(".repo-enable").click(function(){
      <% if(defined?(repositories)) -%>
        $("h4#repo_add_title").text("Enable Repository");
      <% else -%>
        repo_url = $(this).attr("repo-url");
        $("h4#repo_add_title").text("Enable " + $(this).attr("repo-name"));
      <% end -%>
      return true;
    });
    $("button#repo_enable_button").click(function(){
      if(!repo_url){
        repo_url = $('input#repository').attr("value");
      }
      $('form#repo_enable').attr("action", repo_url);
      $('form#repo_enable').submit();
    });
  });
<% end %>
