<%= javascript_tag do %>
  jQuery(document).ready(function($){
    <% if(defined?(repositories)) -%>
      $('input#repository').typeahead({
        name: 'repository',
        local: [<%=
                   repositories.map{|repo|
                     val = []
                     val << "value: '#{repository_enable_url(Base64.encode(repo.full_name))}'"
                     val << "name: '#{repo.full_name}'"
                     val << "tokens: ['#{repo.full_name}', '#{repo.name}']"
                     "{#{val.join(', ')}}"
                   }
                 %>]
      });
    <% end -%>

    var repo_url = null;
    $(".linked").click(function(){
      window.document.location = $(this).attr("href");
    });
    $(".repo-enable").click(function(){
      <% if(defined?(repositories)) ->
        $("h4#repo_add_title").text("Enable Repository");
      <% else -%>
        repo_url = $(this).attr("repo-url");
        $("h4#repo_add_title").text("Enable " + $(this).attr("repo-name"));
      <% end -%>
      return true;
    });
    $("button#repo_enable_button").click(function(){
      if(!repo_url){
        repo_url = $('input#repository').attr("value");
      }
      $('form#repo_enable').attr("action", repo_url);
      $('form#repo_enable').submit();
    });
  });
<% end %>
