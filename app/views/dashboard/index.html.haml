%div.add-repo
  %div.container.container-padding
    %div.row
      %div.col-sm-3
        %div.repo-enable.fission-button{ href: "#", 'data-toggle' => 'modal', 'data-target' => '#repo_options_add' }= "Add a repository"
      %div.col-sm-9
        %p= "Add a new repository!"

%div.dashboard
  %div.container
    %div.row
      // Accounts
      %div.col-sm-6.widget
        %div.panel.panel-default
          %div.panel-heading
            %h2= "Accounts"
          %div.panel-body
            %p= "Manage multiple GitHub Organizations (here called 'Accounts') from your Packager dashboard!"
          %table.table.table-hover
            %thead
              %tr
                %th= "Name"
                %th= "Subscription"
            %tbody
              - @accounts.each do |account|
                %tr
                  %td
                    %a.h4{ href: "/accounts/#{account.id}" }= account.name
                  %td.dasbhoard-action-tray
                    - if account.subscription_id
                      - plan = Rails.application.config.fission.pricing[:packager].try(:[], account.subscription_plan_id).try(:[], :title) || 'unknown'
                      %span{ class: plan }= plan
                      %a.dashboard-action{ href: "/accounts/#{account.key}/order/new" }
                        %i.fa{ class: "fa-credit-card #{plan}" }
                    - else
                      = "(none)"
                      %a.dashboard-action{ href: "/accounts/#{account.key}/order/new" }
                        %i.fa{ class: "fa-credit-card" }

      // Repositories
      %div.col-sm-6.widget
        %div.panel.panel-default
          %div.panel-heading
            %h2= "Repositories"
          %div.panel-body
            %p= "Manage configuration settings for your source code repositories here."
          - @repos.each do |account_name, repos|
            - account = Account.find_by_name(account_name)
            %div.table-responsive
              %table.table.table-hover
                %thead
                  %th= "Name"
                  %th= "Settings"
                %tbody
                  - repos.each do |repo|
                    %tr
                      %td
                        %a.h4{ href: "/accounts/#{account.id}/repositories" }= repo.name
                      %td.dashboard-action-tray
                        %a.dashboard-action{ href: repository_disable_url(repo, :account_id => account.id) }
                          %i.fa{ class: "fa-trash-o", title: "Delete Repository" }
                        %a.dashboard-action{ href: "/accounts/#{account.id}/repositories" }
                          %i.fa{ class: "fa-cogs", title: "Repository Settings" }
                        %a.dashboard-action{ href: "#", "data-toggle" => "modal", "repo-name" => repo.name, "data-target" => "#repo_options_update"}
                          %i.fa{ class: "fa-filter", title: "Integration Filter Setting" }
                        %a.dashboard-action{ href: "https://github.com/#{repo.name}" }
                          %i.fa{ class: "fa-github-alt", title: "GitHub Repository" }

        - if @repos.empty?
          %div.alert.alert-info
            %strong= "You haven't added any repositories!"
            != "Click <a href='#', data-toggle= 'modal', data-target= '#repo_options_add'>here</a> to add your first repository and get started."


%div.container.navfix

= render :partial => 'repositories/enable_popup', :locals => {:repositories => @unregistered_repos, :name => 'add'}
= render :partial => 'repositories/enable_popup', :locals => {:name => 'update'}

:javascript
  $('.repo-url').popover();
